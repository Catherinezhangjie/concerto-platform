{
    "version": "5.0.beta.9.1",
    "collection": [
        {
            "class_name": "Test",
            "id": 54,
            "name": "_linearTestNextItemSelectorModule",
            "accessibility": 0,
            "archived": "0",
            "visibility": 2,
            "type": 0,
            "code": "getSessionId = function(session) {\n  id = 0\n  if(!is.null(session) && is.list(session)) {\n    id = session$id\n  } else {\n    id = paste0(\"i\",concerto$session$id)\n  }\n  return(id)\n}\n\ngetSafeItem = function(item) {\n  item = as.list(item)\n  \n  if(is.character(item$responseOptions)) { item$responseOptions = fromJSON(item$responseOptions) }\n  responseOptionsRandomOrder = item$responseOptions$optionsRandomOrder == \"1\"\n  orderedOptions = c()\n\n  if(length(item$responseOptions$options) > 0) {\n    if(responseOptionsRandomOrder) {\n      orderedOptions = item$responseOptions$options[sample(1:length(item$responseOptions$options))]\n    } else {\n      orderedOptions = item$responseOptions$options\n    }\n  }\n  orderedOptions = lapply(orderedOptions, function(elem) {\n    elem$score = NULL\n    return(elem)\n  })\n  \n  item$responseOptions$options = orderedOptions\n  item$responseOptions$openScore = NULL\n  item$responseOptions$openCorrect = NULL\n  return(item)\n}\n\ngetSafePastResponse = function(item, session, responseBank) {\n  responseBank = fromJSON(responseBank)\n  if(is.null(responseBank$table)) {\n    concerto.log(\"no response bank defined\")\n    return(NULL)\n  }\n  \n  sql = \"\nSELECT * FROM {{table}}\nWHERE \n{{sessionIdColumn}}='{{sessionId}}' AND\n{{itemIdColumn}}={{itemId}}\n\"\n  response = concerto.table.query(sql, list(\n    table=responseBank$table,\n    sessionIdColumn=responseBank$columns$session_id,\n    sessionId=getSessionId(session),\n    itemIdColumn=responseBank$columns$item_id,\n    itemId=item$id\n  ))\n  if(dim(response)[1] > 0) {\n    response = as.list(response)\n    response$score = NULL\n    return(response)\n  }\n  return(NULL)\n}\n\nconcerto.log(prevItemIndex, \"prevItemIndex\")\nconcerto.log(direction, \"direction\")\nnextItemIndex = as.numeric(prevItemIndex) + as.numeric(direction)\nconcerto.log(nextItemIndex, \"next item index\")\nnextItem = items[nextItemIndex,]\nnextItemSafe = getSafeItem(nextItem)\npastResponseSafe = getSafePastResponse(nextItem, session, settings$responseBank)",
            "outdated": "0",
            "description": "",
            "variables": [
                {
                    "class_name": "TestVariable",
                    "id": 441,
                    "name": "out",
                    "type": 2,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "0",
                    "test": 54,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 450,
                    "name": "items",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 54,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 451,
                    "name": "nextItemIndex",
                    "type": 1,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 54,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 452,
                    "name": "nextItem",
                    "type": 1,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 54,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 459,
                    "name": "itemsAdministrered",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 54,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 460,
                    "name": "direction",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "1",
                    "test": 54,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 526,
                    "name": "nextItemSafe",
                    "type": 1,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 54,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 587,
                    "name": "prevItemIndex",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "0",
                    "test": 54,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 591,
                    "name": "session",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 54,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 592,
                    "name": "pastResponseSafe",
                    "type": 1,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 54,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 593,
                    "name": "responseBank",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 54,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 599,
                    "name": "settings",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 54,
                    "parentVariable": null
                }
            ],
            "sourceWizard": null,
            "sourceWizardName": null,
            "sourceWizardTest": null,
            "sourceWizardTestName": null,
            "updatedOn": "2019-01-31 10:45:10",
            "updatedBy": "admin",
            "nodes": [],
            "nodesConnections": [],
            "tags": "",
            "owner": 1,
            "groups": "",
            "starterContent": true,
            "hash": "5ef450b47e0b58cfadff76b95f6a31d721b1ab3e"
        }
    ]
}