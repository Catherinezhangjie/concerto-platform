{
    "version": "5.0.beta.9.1",
    "collection": [
        {
            "class_name": "Test",
            "id": 67,
            "name": "_questionnaireNextItemSelectorModule",
            "accessibility": 0,
            "archived": "0",
            "visibility": 2,
            "type": 0,
            "code": "getSessionId = function(session) {\n  id = 0\n  if(!is.null(session) && is.list(session)) {\n    id = session$id\n  } else {\n    id = paste0(\"i\",concerto$session$id)\n  }\n  return(id)\n}\n\ngetSafeItems = function(items) {\n  items[,\"reversedScore\"] = NULL\n  return(items)\n}\n\ngetSafePastResponses = function(nextItems, session, responseBank) {\n  responseBank = fromJSON(responseBank)\n  if(is.null(responseBank$table)) {\n    concerto.log(\"no response bank defined\")\n    return(NULL)\n  }\n\n  sql = \"\nSELECT * FROM {{table}}\nWHERE \n{{sessionIdColumn}}='{{sessionId}}' AND\n{{itemIdColumn}} IN ({{itemIds}})\n\"\n  #TODO: instead of itemIdColumn IN (itemIds) should use LIMIT\n  response = concerto.table.query(sql, list(\n    table=responseBank$table,\n    sessionIdColumn=responseBank$columns$session_id,\n    sessionId=getSessionId(session),\n    itemIdColumn=responseBank$columns$item_id,\n    itemIds=paste(nextItems[,\"id\"], collapse=\",\")\n  ))\n  if(dim(response)[1] > 0) {\n    response[,\"score\"] = NULL\n    return(response)\n  }\n  return(NULL)\n}\n\nconcerto.log(prevPage, \"previous page\")\nconcerto.log(direction, \"direction\")\nnextPage = as.numeric(prevPage) + as.numeric(direction)\n\npageFirstItemIndex = (nextPage - 1) * as.numeric(settings$itemsPerPage) + 1\npageLastItemIndex = min(nextPage * as.numeric(settings$itemsPerPage), dim(items)[1])\n\nnextItemsIndices = pageFirstItemIndex:pageLastItemIndex\nconcerto.log(nextItemsIndices, \"next item indices\")\nnextItems = items[nextItemsIndices,]\nnextItemsSafe = getSafeItems(nextItems)\npastResponsesSafe = getSafePastResponses(nextItems, session, settings$responseBank)",
            "outdated": "0",
            "description": "",
            "variables": [
                {
                    "class_name": "TestVariable",
                    "id": 667,
                    "name": "out",
                    "type": 2,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "0",
                    "test": 67,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 668,
                    "name": "direction",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "1",
                    "test": 67,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 669,
                    "name": "items",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 67,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 670,
                    "name": "itemsAdministered",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 67,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 671,
                    "name": "prevPage",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": "0",
                    "test": 67,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 672,
                    "name": "session",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 67,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 673,
                    "name": "settings",
                    "type": 0,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 67,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 674,
                    "name": "nextItems",
                    "type": 1,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 67,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 675,
                    "name": "nextItemsIndices",
                    "type": 1,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 67,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 676,
                    "name": "nextPage",
                    "type": 1,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 67,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 677,
                    "name": "nextItemsSafe",
                    "type": 1,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 67,
                    "parentVariable": null
                },
                {
                    "class_name": "TestVariable",
                    "id": 678,
                    "name": "pastResponsesSafe",
                    "type": 1,
                    "description": "",
                    "passableThroughUrl": "0",
                    "value": null,
                    "test": 67,
                    "parentVariable": null
                }
            ],
            "sourceWizard": null,
            "sourceWizardName": null,
            "sourceWizardTest": null,
            "sourceWizardTestName": null,
            "updatedOn": "2019-02-13 11:59:41",
            "updatedBy": "admin",
            "nodes": [],
            "nodesConnections": [],
            "tags": "",
            "owner": null,
            "groups": "",
            "starterContent": true,
            "hash": "dc067471c579aeaffd53f1581238fde8fa541b70"
        }
    ]
}